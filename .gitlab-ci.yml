image: "tbcp/nodejs:ubuntu"

stages:
  - Linting
  - Testing
  - Building
  - Deployment

before_script:
  - yarn install
  - yarn run git:sub:merge

# This folder is cached between builds http://docs.gitlab.com/ce/ci/yaml/README.html#cache
cache:
  paths:
    - node_modules/

lint:fix:
  stage: Linting
  script:
    - yarn run lint:fix
  allow_failure: true

test:unit:
  stage: Testing
  script:
    - yarn run test:unit

build:
  stage: Building
  script:
    - yarn run build
  artifacts:
    paths: [build]
  only:
    - main

pages:
  stage: Deployment
  script:
    - mkdir ./public
    - cp -r README.md public/
  artifacts:
    paths: [public]
    expire_in: 1 mins
